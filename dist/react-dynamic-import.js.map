{"version":3,"file":"react-dynamic-import.js","sources":["../src/index.js"],"sourcesContent":["/* eslint-disable react/prop-types */\nimport React, { Component, forwardRef } from \"react\";\n\nconst defaultErrorHandler = ({ name, error: { message } }) =>\n  `Failed to fetch dynamic module: ${name}.\\nError: ${message}.`;\n\nconst defaultPlaceholder = () => null;\n\n/**\n * Dynamically load any react module(Component or an HOC)\n *\n * @example\n *  - Module loader function\n *      const loader = f => import(`./dynamic/${f}.js`);\n *  - Use dynamic module(Make sure to use it outside render method, else new component is rendered in each render)\n *      const RealComponent = DynamicImport({ name: 'realModuleName', loader }),\n *\n * @param {Object} options - Options passed to react dynamic import functions\n * @param {Function} options.loader - function which takes module name and returns promise\n * @param {Boolean} [options.isHOC=false] - Is the module a HOC?\n * @param {String} [options.name] - Dynamic module to be fetched(Mostly it will be part of the module file name),\n *                                        optional if loader returns same component every time\n * @param {Component} [options.placeholder=defaultPlaceholder] - React component to be rendered until actual module is fetched\n *                                                               (You can add UX improvements like adding small delay before showing\n *                                                               loader inside your class/functional component)\n * @param {Component} [options.errorHandler=defaultErrorHandler] - React component to be rendered if fetching actual module fails.\n *                                                                 This will receive `name` and `error` object as `props`\n */\nconst DynamicImportWrapper = ({\n  loader,\n  isHOC = false,\n  name,\n  placeholder: DefaultPlaceholder = defaultPlaceholder,\n  errorHandler: ErrorHandler = defaultErrorHandler\n}) => {\n  if (!loader || (loader && typeof loader !== \"function\")) {\n    throw new Error(\"'loader' is required and should be of type 'function'.\");\n  }\n\n  class DynamicImport extends Component {\n    static displayName = `DynamicImport${isHOC ? \":HOC\" : \"\"}(${name || \"?\"})`;\n\n    isMounted = false;\n\n    state = {\n      DynamicComponent: null,\n      fetchError: null\n    };\n\n    componentDidMount() {\n      this.isMounted = true;\n      const loaderPromise = loader(name);\n\n      if (\n        !loaderPromise ||\n        (loaderPromise && !(loaderPromise instanceof Promise))\n      ) {\n        throw new Error(\n          `Expected 'loader' to return a 'Promise', it returned '${typeof loaderPromise}' instead.`\n        );\n      }\n\n      loader(name)\n        .then(mod => {\n          const { hocArgs } = this.props;\n          const m = mod.default || mod;\n\n          if (this.isMounted) {\n            this.setState({\n              DynamicComponent: isHOC ? m(...hocArgs) : m\n            });\n          }\n        })\n        .catch(fetchError => {\n          this.setState({ fetchError });\n        });\n    }\n\n    componentWillUnmount() {\n      this.isMounted = false;\n    }\n\n    render() {\n      const { DynamicComponent, fetchError } = this.state;\n      const { hocArgs, forwardedRef, ...props } = this.props;\n\n      if (fetchError) {\n        return <ErrorHandler error={fetchError} name={name} />;\n      }\n\n      return DynamicComponent ? (\n        <DynamicComponent {...props} ref={forwardedRef} />\n      ) : (\n        <DefaultPlaceholder name={name} />\n      );\n    }\n  }\n\n  return isHOC\n    ? (...args) =>\n        forwardRef(function DynamicImportHOCFetcher(props, ref) {\n          return <DynamicImport {...props} forwardedRef={ref} hocArgs={args} />;\n        })\n    : forwardRef(function DynamicImportFetcher(props, ref) {\n        return <DynamicImport {...props} forwardedRef={ref} />;\n      });\n};\n\nexport default DynamicImportWrapper;\n"],"names":["defaultErrorHandler","name","message","error","defaultPlaceholder","DynamicImportWrapper","loader","isHOC","placeholder","DefaultPlaceholder","errorHandler","ErrorHandler","Error","DynamicImport","DynamicComponent","fetchError","isMounted","loaderPromise","Promise","then","mod","hocArgs","props","m","default","setState","catch","state","forwardedRef","React","Component","args","forwardRef","DynamicImportHOCFetcher","ref","DynamicImportFetcher"],"mappings":"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"}