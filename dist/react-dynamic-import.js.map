{"version":3,"file":"react-dynamic-import.js","sources":["../src/index.js"],"sourcesContent":["/* eslint-disable react/prop-types */\nimport * as React from 'react';\n\nconst defaultErrorHandler = ({ name, error: { message } }) =>\n  `Unable to fetch module: ${name}.\\nError: ${message}.`;\n\nconst defaultPlaceholder = () => null;\n\n/**\n * Dynamically load any react module(Component or an HOC)\n *\n * @example\n *  - Module loader function\n *      const loader = f => import(`./dynamic/${f}.js`);\n *  - Use dynamic module(Make sure to use it outside render method, else new component is rendered in each render)\n *      const RealComponent = DynamicImport({ name: 'realModuleName', loader }),\n *\n * @param {Object} options - Options passed to react dynamic import functions\n * @param {Function} options.loader - function which takes module name and returns promise to resolve module\n * @param {Boolean} [options.isHOC=false] - Is the module an HOC?\n * @param {String} [options.name] - Dynamic module to be fetched(Mostly it will be part of the module file name),\n *                                        optional if loader returns same component every time\n * @param {Component} [options.placeholder=defaultPlaceholder] - React component to be rendered until actual module is fetched\n *                                                               (You can add UX improvements like adding small delay before showing\n *                                                               loader inside your class/functional component)\n * @param {Component} [options.errorHandler=defaultErrorHandler] - React component to be rendered if fetching actual module fails.\n *                                                                 This will receive `name` and `error` object as `props`\n */\nconst DynamicImportWrapper = ({\n  loader,\n  isHOC = false,\n  name,\n  placeholder: Placeholder = defaultPlaceholder,\n  errorHandler: ErrorHandler = defaultErrorHandler,\n}) => {\n  if (!loader || (loader && typeof loader !== 'function')) {\n    throw new Error(\"'loader' is required and should be of type 'function'.\");\n  }\n\n  function DynamicImport(props) {\n    const isMounted = React.useRef(false);\n    const [DynamicModule, setDynamicModule] = React.useState(null);\n    const [fetchError, setFetchError] = React.useState(null);\n    const { hocArgs, forwardedRef, ...rest } = props;\n\n    React.useEffect(() => {\n      isMounted.current = true;\n      const loaderPromise = loader(name);\n\n      if (\n        !loaderPromise ||\n        (loaderPromise && !(loaderPromise instanceof Promise))\n      ) {\n        throw new Error(\n          `Expected 'loader' to return a 'Promise', but, it returned '${typeof loaderPromise}' instead.`,\n        );\n      }\n\n      // Async await increases the bundle size\n      loaderPromise\n        .then(mod => {\n          if (isMounted.current) {\n            const m = mod.default || mod;\n\n            // useState executes the function if functional component is passed\n            setDynamicModule({ component: isHOC ? m(...hocArgs) : m });\n          }\n        })\n        .catch(err => {\n          if (isMounted.current) {\n            setFetchError(err);\n          }\n        });\n\n      return () => {\n        isMounted.current = false;\n      };\n    }, [hocArgs]);\n\n    if (fetchError) {\n      return <ErrorHandler error={fetchError} name={name} />;\n    }\n\n    return DynamicModule ? (\n      <DynamicModule.component {...rest} ref={forwardedRef} />\n    ) : (\n      <Placeholder name={name} />\n    );\n  }\n\n  DynamicImport.displayName = `DynamicImport${isHOC ? ':HOC' : ''}(${name ||\n    'Unknown'})`;\n\n  function DynamicImportFetcher(props, ref) {\n    return <DynamicImport {...props} forwardedRef={ref} />;\n  }\n  DynamicImportFetcher.displayName = 'DynamicImportFetcher';\n\n  const ComponentFetcher = React.forwardRef(DynamicImportFetcher);\n\n  const HOCFetcher = (...args) => {\n    function DynamicImportHOCFetcher(props, ref) {\n      return <DynamicImport {...props} forwardedRef={ref} hocArgs={args} />;\n    }\n    DynamicImportHOCFetcher.displayName = 'DynamicImportHOCFetcher';\n\n    return React.forwardRef(DynamicImportHOCFetcher);\n  };\n\n  return isHOC ? HOCFetcher : ComponentFetcher;\n};\n\nexport default DynamicImportWrapper;\n"],"names":["defaultErrorHandler","name","message","error","defaultPlaceholder","DynamicImportWrapper","loader","isHOC","placeholder","Placeholder","errorHandler","ErrorHandler","Error","DynamicImport","props","isMounted","React","DynamicModule","setDynamicModule","fetchError","setFetchError","hocArgs","forwardedRef","rest","current","loaderPromise","Promise","then","mod","m","component","err","React.createElement","displayName","DynamicImportFetcher","ref","ComponentFetcher","HOCFetcher","args","DynamicImportHOCFetcher"],"mappings":"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"}